<!doctype html>
<html>
<head>
  <meta charset="utf-8"/>
  <title>Court Booking Demo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="p-4">
  <div class="container">
    <h1>Court Booking Demo</h1>
    <div class="row">
      <div class="col-md-6">
        <h4>Search Availability</h4>
        <form id="searchForm">
          <div class="mb-2">
            <label>Type</label>
            <select id="type" class="form-select">
              <option value="BADMINTON">Badminton</option>
              <option value="PICKLEBALL">Pickleball</option>
            </select>
          </div>
          <div class="mb-2">
            <label>Start (ISO)</label>
            <input id="start" class="form-control" value="2025-11-07T10:00:00"/>
          </div>
          <div class="mb-2">
            <label>End (ISO)</label>
            <input id="end" class="form-control" value="2025-11-07T11:00:00"/>
          </div>
          <button class="btn btn-primary" type="submit">Search</button>
        </form>

        <h5 class="mt-3">Available Courts</h5>
        <ul id="courts" class="list-group"></ul>
      </div>

      <div class="col-md-6">
        <h4>Create Booking</h4>
        <form id="bookForm">
          <div class="mb-2"><label>Court ID</label><input id="courtId" class="form-control"/></div>
          <div class="mb-2"><label>Player IDs (comma separated)</label><input id="playerIds" class="form-control" value="p1"/></div>
          <div class="mb-2"><label>Start (ISO)</label><input id="bstart" class="form-control" value="2025-11-07T10:00:00"/></div>
          <div class="mb-2"><label>End (ISO)</label><input id="bend" class="form-control" value="2025-11-07T11:00:00"/></div>
          <button class="btn btn-success" type="submit">Book</button>
        </form>

        <h5 class="mt-3">Latest Booking Result</h5>
        <pre id="result"></pre>
      </div>
    </div>

    <hr/>
    <h4>Existing Bookings</h4>
    <pre id="allBookings"></pre>
  </div>

  <script>
    async function search(e){
      if(e) e.preventDefault();
      const type = document.getElementById('type').value;
      const start = document.getElementById('start').value;
      const end = document.getElementById('end').value;
      const res = await fetch(`/api/courts/search?type=${encodeURIComponent(type)}&start=${encodeURIComponent(start)}&end=${encodeURIComponent(end)}`);
      const data = await res.json();
      const ul = document.getElementById('courts');
      ul.innerHTML = '';
      data.forEach(c => {
        const li = document.createElement('li');
        li.className = 'list-group-item d-flex justify-content-between align-items-center';
        li.textContent = c.id + ' (' + c.type + ')';
        const btn = document.createElement('button');
        btn.className = 'btn btn-sm btn-outline-primary';
        btn.textContent = 'Use';
        btn.onclick = () => document.getElementById('courtId').value = c.id;
        li.appendChild(btn);
        ul.appendChild(li);
      });
    }

    document.getElementById('searchForm').addEventListener('submit', search);

    document.getElementById('bookForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      const body = {
        courtId: document.getElementById('courtId').value,
        start: document.getElementById('bstart').value,
        end: document.getElementById('bend').value,
        playerIds: document.getElementById('playerIds').value.split(',').map(s => s.trim()).filter(s => s)
      };
      const res = await fetch('/api/bookings', {
        method: 'POST', headers: {'Content-Type':'application/json'}, body: JSON.stringify(body)
      });
      const data = await res.json().catch(()=>({error:'invalid response'}));
      document.getElementById('result').textContent = JSON.stringify(data, null, 2);
      loadBookings();
      search();
    });

    async function loadBookings(){
      const res = await fetch('/api/bookings');
      const data = await res.json();
      document.getElementById('allBookings').textContent = JSON.stringify(data, null, 2);
    }

    // initial
    search();
    loadBookings();
  </script>
</body>
</html>
